<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>better-dom Source: DOM.parsetemplate.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">better-dom</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="DOM.html">DOM</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="$CompositeElement.html">$CompositeElement</a>
						</li>
						
						<li>
							<a href="$Element.html">$Element</a>
						</li>
						
						<li>
							<a href="$Node.html">$Node</a>
						</li>
						
						<li>
							<a href="$NullElement.html">$NullElement</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: DOM.parsetemplate.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript ">define(["DOM"], function(DOM, _map, _forEach) {
    "use strict";

    // EMMET EXPRESSIONS PARSER
    // ------------------------

    (function() {
        // operator type / priority object
        var operators = {"(": 1,")": 2,"^": 3,">": 4,"+": 4,"*": 5,"}": 5,"{": 6,"]": 5,"[": 6,".": 7,"#": 8,":": 9},
            reTextTag = /&lt;\?>|&lt;\/\?>/g,
            reAttr = /([\w\-]+)(?:=((?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^\s\]]+)))?/g,
            reIndex = /(\$+)(?:@(-)?([0-9]+)?)?/g,
            normalizeAttrs = function(term, name, value, a, b, simple) {
                // always wrap attribute values with quotes if they don't exist
                return name + "=" + (simple || !value ? "\"" + (value || "") + "\"" : value);
            },
            injectTerm = function(term, first) {
                return function(el) {
                    var index = first ? el.indexOf(">") : el.lastIndexOf("&lt;");
                    // inject term into the html string
                    return el.substr(0, index) + term + el.substr(index);
                };
            },
            makeTerm = (function() {
                var results = {};

                // populate empty tags
                _forEach("area base br col hr img input link meta param command keygen source".split(" "), function(tag) {
                    results[tag] = "&lt;" + tag + ">";
                });

                return function(tag) {
                    var result = results[tag];

                    if (!result) {
                        results[tag] = result = "&lt;" + tag + ">&lt;/" + tag + ">";
                    }

                    return [result];
                };
            }()),
            makeIndexedTerm = function(term) {
                return function(_, i, arr) {
                    return term.replace(reIndex, function(expr, fmt, sign, base) {
                        var index = (sign ? arr.length - i - 1 : i) + (base ? base | 0 : 1);
                        // make zero-padding index string
                        return (fmt + index).slice(-fmt.length).split("$").join("0");
                    });
                };
            },
            toString = function(term) {
                return typeof term === "string" ? term : term.join("");
            };

        /**
         * Parse emmet-like template to HTML string
         * @memberOf DOM
         * @param  {String} template emmet-like expression
         * @return {String} HTML string
         * @see http://docs.emmet.io/cheat-sheet/
         */
        DOM.parseTemplate = function(template) {
            var stack = [],
                output = [],
                term = "",
                i, n, str, priority, skip, node;

            // parse exrpression into RPN

            for (i = 0, n = template.length; i &lt; n; ++i) {
                str = template[i];
                // concat .c1.c2 into single space separated class string
                if (str === "." && stack[0] === ".") str = " ";

                priority = operators[str];

                if (priority && (!skip || skip === str)) {
                    // append empty tag for text nodes or put missing '>' operator into the stack
                    if (str === "{") {
                        if (term) {
                            stack.unshift(">");
                        } else {
                            term = "?";
                        }
                    }
                    // remove redundat ^ operators from the stack when more than one exists
                    if (str === "^" && stack[0] === "^") stack.shift();

                    if (term) {
                        output.push(term);
                        term = "";
                    }

                    if (str !== "(") {
                        while (operators[stack[0]] > priority) {
                            output.push(stack.shift());
                            // for ^ operator stop shifting when the first > is found
                            if (str === "^" && output[output.length - 1] === ">") break;
                        }
                    }

                    if (str === ")") {
                        stack.shift(); // remove "(" symbol from stack
                    } else if (!skip) {
                        stack.unshift(str);

                        if (str === "[") skip = "]";
                        if (str === "{") skip = "}";
                    } else {
                        skip = false;
                    }
                } else {
                    term += str;
                }
            }

            if (term) stack.unshift(term);

            output.push.apply(output, stack);

            // transform RPN into html nodes

            stack = [];

            if (output.length === 1) output.push(">");

            for (i = 0, n = output.length; i &lt; n; ++i) {
                str = output[i];

                if (str in operators) {
                    term = stack.shift();
                    node = stack.shift() || "?";

                    if (typeof node === "string") node = makeTerm(node);

                    switch(str) {
                    case ".":
                        term = injectTerm(" class=\"" + term + "\"", true);
                        break;

                    case "#":
                        term = injectTerm(" id=\"" + term + "\"", true);
                        break;

                    case ":":
                        term = injectTerm(" type=\"" + term + "\"", true);
                        break;

                    case "[":
                        term = injectTerm(" " + term.replace(reAttr, normalizeAttrs), true);
                        break;

                    case "{":
                        term = injectTerm(term);
                        break;

                    case "*":
                        node = _map(Array(term | 0), makeIndexedTerm(toString(node)));
                        break;

                    default:
                        if (typeof term === "string") term = makeTerm(term)[0];

                        term = toString(term);

                        if (str === ">") {
                            term = injectTerm(term);
                        } else {
                            node.push(term);
                        }
                    }

                    str = typeof term === "function" ? _map(node, term) : node;
                }

                stack.unshift(str);
            }

            return toString(stack[0]).replace(reTextTag, "");
        };
    })();
});
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a>
		on Sun Sep 01 2013 14:50:32 GMT+0300 (FET) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:false,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
